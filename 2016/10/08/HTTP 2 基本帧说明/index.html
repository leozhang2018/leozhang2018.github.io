<!DOCTYPE html><html class="theme-next muse use-motion" lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="theme-color" content="#222"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="//fonts.googleapis.com/css?family=Exo 2:300,300italic,400,400italic,700,700italicExo 2:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css"><link href="https://lib.baomitu.com/font-awesome/4.6.2/css/font-awesome.min.css" rel="stylesheet" type="text/css"><link href="/css/main.css?v=6.0.3" rel="stylesheet" type="text/css"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.0.3"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-64x64.png?v=6.0.3"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-32x32.png?v=6.0.3"><link rel="mask-icon" href="/images/logo.svg?v=6.0.3" color="#222"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Muse",version:"6.0.3",sidebar:{position:"left",display:"post",offset:12,b2t:!1,scrollpercent:!1,onmobile:!1},fancybox:!1,fastclick:!1,lazyload:!1,tabs:!0,motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><meta name="keywords" content="Web,HTTP/2,"><meta name="description" content="HTTP/2 在没有破坏原有的语义化（例如：方法、状态码、URIs、首部字段……）的基础上，更改了数据的封装格式以及客户端和服务器之间的数据传输机制，引入了二进制分帧层（Binary Framing）采用新的编码机制，客户端与服务器之间的通信信息被分割成更小的帧，每个帧都是二进制编码。本文将对 HTTP/2 和 HTTP/1.1 的差异部分进行对比，同时对 HTTP/2 部分关键帧进行梳理说明。"><meta name="keywords" content="Web,HTTP&#x2F;2"><meta property="og:type" content="article"><meta property="og:title" content="HTTP&#x2F;2 基本帧说明"><meta property="og:url" content="https://leozhang2018.me/2016/10/08/HTTP 2 基本帧说明/index.html"><meta property="og:site_name" content="leozhang2018"><meta property="og:description" content="HTTP/2 在没有破坏原有的语义化（例如：方法、状态码、URIs、首部字段……）的基础上，更改了数据的封装格式以及客户端和服务器之间的数据传输机制，引入了二进制分帧层（Binary Framing）采用新的编码机制，客户端与服务器之间的通信信息被分割成更小的帧，每个帧都是二进制编码。本文将对 HTTP/2 和 HTTP/1.1 的差异部分进行对比，同时对 HTTP/2 部分关键帧进行梳理说明。"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://leozhang2018.me/images/2016-10-08/banner.png"><meta property="og:image" content="https://leozhang2018.me/images/2016-10-08/request.png"><meta property="og:image" content="https://leozhang2018.me/images/2016-10-08/response.png"><meta property="og:image" content="https://leozhang2018.me/images/2016-10-08/netinternals.png"><meta property="og:image" content="https://leozhang2018.me/images/2016-10-08/ssllog.png"><meta property="og:image" content="https://leozhang2018.me/images/2016-10-08/premasterkey.png"><meta property="og:image" content="https://leozhang2018.me/images/2016-10-08/h2traffic.png"><meta property="og:updated_time" content="2021-11-17T08:24:22.215Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="HTTP&#x2F;2 基本帧说明"><meta name="twitter:description" content="HTTP/2 在没有破坏原有的语义化（例如：方法、状态码、URIs、首部字段……）的基础上，更改了数据的封装格式以及客户端和服务器之间的数据传输机制，引入了二进制分帧层（Binary Framing）采用新的编码机制，客户端与服务器之间的通信信息被分割成更小的帧，每个帧都是二进制编码。本文将对 HTTP/2 和 HTTP/1.1 的差异部分进行对比，同时对 HTTP/2 部分关键帧进行梳理说明。"><meta name="twitter:image" content="https://leozhang2018.me/images/2016-10-08/banner.png"><link rel="canonical" href="https://leozhang2018.me/2016/10/08/HTTP 2 基本帧说明/"><script type="text/javascript" id="page.configurations">CONFIG.page={sidebar:""}</script><title>HTTP/2 基本帧说明 | leozhang2018</title><noscript><style type="text/css">.sidebar-inner,.use-motion .brand,.use-motion .collection-title,.use-motion .comments,.use-motion .menu-item,.use-motion .motion-element,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .logo,.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.logo-line-after i{right:initial}</style></noscript></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">leozhang2018</span> <span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle"></p></div><div class="site-nav-toggle"><button><span class="btn-bar"></span> <span class="btn-bar"></span> <span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section">首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section">标签</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section">归档</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section">关于</a></li></ul></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="https://leozhang2018.me/2016/10/08/HTTP 2 基本帧说明/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="leozhang2018"><meta itemprop="description" content=""><meta itemprop="image" content="/images/avatar.png"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="leozhang2018"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">HTTP/2 基本帧说明</h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-10-08T19:00:25+08:00">2016-10-08</time></span></div></header><div class="post-body" itemprop="articleBody"><p><img src="/images/2016-10-08/banner.png" alt="H2frame"><br>HTTP/2 在没有破坏原有的语义化（例如：方法、状态码、URIs、首部字段……）的基础上，更改了数据的封装格式以及客户端和服务器之间的数据传输机制，引入了二进制分帧层（Binary Framing）采用新的编码机制，客户端与服务器之间的通信信息被分割成更小的帧，每个帧都是二进制编码。本文将对 HTTP/2 和 HTTP/1.1 的差异部分进行对比，同时对 HTTP/2 部分关键帧进行梳理说明。<br><a id="more"></a></p><h2 id="显示部分"><a href="#显示部分" class="headerlink" title="显示部分"></a>显示部分</h2><h3 id="REQUEST"><a href="#REQUEST" class="headerlink" title="REQUEST"></a>REQUEST</h3><p>HTTP/2 VS HTTP/1.1<br><img src="/images/2016-10-08/request.png" alt="request"><br>HTTP/2 Header部分新增冒号开头 <code>authority</code> <code>method</code> <code>path</code> <code>scheme</code> 首部，同时所有字段均小写</p><h3 id="RESPONSE"><a href="#RESPONSE" class="headerlink" title="RESPONSE"></a>RESPONSE</h3><p>HTTP/2 VS HTTP/1.1</p><p><img src="/images/2016-10-08/response.png" alt="response"></p><p>所有字段均小写,其余基本相同</p><h2 id="流量部分"><a href="#流量部分" class="headerlink" title="流量部分"></a>流量部分</h2><p>调试工具:</p><ul><li>Chrome net-internal</li><li>Wireshark</li></ul><p><strong>Chrome net-internal</strong>：<br>以 Chrome (版本:53.0.2785.143) 为例,通过其内置的 net-internals 工具(地址栏输入 <code>chrome://net-internals/#http2</code>)即可查看当前活跃的 HTTP/2 会话，通过选择对应的会话 ID 可以查看经过处理后的全部帧信息。</p><p><img src="/images/2016-10-08/netinternals.png" alt="response"></p><p><strong>Wireshark</strong></p><p>主流浏览器目前只支持 <strong>HTTP/2 Over TLS</strong>，HTTP/2 网站也都使用了 HTTPS，关于 HTTP/2 是否需要使用 TLS，曾经也有很大的争论，但是出于安全性和用户隐私的考虑，最后决定所有 HTTP/2 的数据传输都需要进行加密。<br>参见：</p><blockquote><p>A lot of focus of http2 has been to make it behave properly over TLS.SPDY is only done over TLS and there’s been a strong push for making TLS mandatory for http2 but it didn’t get consensus and http2 will ship with TLS as optional. However, two prominent implementers have stated clearly that they will only implement http2 over TLS: the Mozilla Firefox lead and the Google Chrome lead. Two of the leading web browsers of today. Reasons for choosing TLS-only include respect for user’s privacy and early measurements showing that new protocols have a higher success rate when done with TLS. This because of the widespread assumption that anything that goes over port 80 is HTTP 1.1 makes some middle-boxes interfere and destroy traffic when instead other protocols are communicated there. The subject about mandatory TLS has caused much hand- waving and agitated voices in mailing lists and meetings – is it good or is it evil? It is an infected subject – be aware of this when you throw this question in the face of a HTTPbis participant! Similarly, there’s been a fierce and long-going debate on whether http2 should dictate a list of ciphers that should be mandatory when using TLS, or if it perhaps should blacklist a set or if it shouldn’t require anything at all from the TLS “layer” but leave that to the TLS WG.</p></blockquote><p><a href="https://http2.github.io/faq/#how-do-i-debug-http2-if-its-encrypted" target="_blank" rel="noopener">那么如何调试 HTTP/2 的加密流量？</a></p><p>最简单的方式是使用 <a href="https://developer.mozilla.org/en-US/docs/Mozilla/Projects/NSS/Key_Log_Format" target="_blank" rel="noopener">NSS keylogging</a> 配合 Wireshark （需版本支持）进行调试。</p><p><strong><a href="https://developer.mozilla.org/zh-CN/docs/NSS" target="_blank" rel="noopener">NSS</a>（Mozilla Network Security Services）</strong></p><p>是一组库目的是支持跨平台开发启用了安全性的多维客户机和服务器应用程序。用 NSS 构建的应用程序可以支持 SSL v2 和 v3,TLS, PKCS #5, PKCS #7, PKCS #11, PKCS #12, S/MIME, X.509 v3 证书，以及其他安全标准。</p><p>NSS 可以将密钥用特定格式写入日志（Key Log），这让外部程序得以借此解密 TLS 链接。Wireshark 1.6 版本以上可以用 Key Log 解密数据包。</p><p>Firefox 和 Chrome 只会在系统环境变量中存在 <strong>SSLKEYLOGFILE</strong> 路径时才会生成它，先来加上这个环境变量（以 Linux 为例）：</p><pre><code>export SSLKEYLOGFILE=~/保存地址/sslkeylog.log
</code></pre><p>这里保存至当前用户的 tls 目录下：</p><pre><code>mkdir ~/tls
export SSLKEYLOGFILE=~/tls/sslkeylog.log
</code></pre><p>你也可以将其写入当前用户的 <strong>.profile</strong> 文件里,这样每次登录时该环境变量都会<strong>自动生效</strong>：</p><p><img src="/images/2016-10-08/ssllog.png" alt="profile"></p><p>更新 profile:</p><pre><code>source .profile
</code></pre><p>打开 Chrome:</p><pre><code>google-chrome
</code></pre><p>启动 Wireshark:</p><pre><code>sudo wireshark
</code></pre><p>接下来，选择监听网卡,打开 Wireshark 的首选项(<code>preferences</code>) ,点击协议(<code>Protocols</code>)选项,将 <code>SSL</code> 配置面板的 <code>(Pre)-Master-Secret log filename</code> 一栏中的文件替换成 <strong>sslkeylog 文件位置</strong> 即可:</p><p><img src="/images/2016-10-08/premasterkey.png" alt="此处输入图片的描述"></p><p>通过 <code>filter</code> 设置过滤规则，即可过滤出 HTTP/2 流量:</p><p><img src="/images/2016-10-08/h2traffic.png" alt="此处输入图片的描述"></p><h2 id="关键帧说明"><a href="#关键帧说明" class="headerlink" title="关键帧说明"></a>关键帧说明</h2></div><div><div style="padding:10px 0;margin:20px auto;width:90%;text-align:center"><div><span style="color:#ddaf3c9c">无「民事行为能力」人慎点</span></div><button id="rewardButton" disable="enable" onclick='var qr=document.getElementById("QR");"none"===qr.style.display?qr.style.display="block":qr.style.display="none"'><span>禁</span></button><div id="QR" style="display:none"><div id="wechat" style="display:inline-block"><img id="wechat_qr" src="/images/wechatpay.png" alt="leozhang2018 微信支付"></div></div></div></div><footer class="post-footer"><div class="post-tags"><a href="/tags/Web/" rel="tag"># Web</a> <a href="/tags/HTTP-2/" rel="tag"># HTTP/2</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/2016/10/04/体验 Apex.sh/" rel="next" title="体验 Apex.sh"><i class="fa fa-chevron-left"></i> 体验 Apex.sh</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"><a href="/2018/05/07/我在用什么/" rel="prev" title="我在用什么">我在用什么 <i class="fa fa-chevron-right"></i></a></div></div></footer></div></article><div class="post-spread"></div></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span> <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span> <span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><section class="site-overview-wrap sidebar-panel sidebar-panel-active"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" src="/images/avatar.png" alt="leozhang2018"><p class="site-author-name" itemprop="name">leozhang2018</p><p class="site-description motion-element" itemprop="description"></p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">24</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/index.html"><span class="site-state-item-count">18</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/leozhang2018" target="_blank" title="GitHub"><i class="fab fa-fw fa-github"></i>GitHub</a> </span><span class="links-of-author-item"><a href="https://twitter.com/leozhang2018" target="_blank" title="Twitter"><i class="fab fa-fw fa-twitter"></i>Twitter</a> </span><span class="links-of-author-item"><a href="https://instagram.com/leozhanghere" target="_blank" title="Instagram"><i class="fab fa-fw fa-instagram"></i>Instagram</a> </span><span class="links-of-author-item"><a href="https://www.zhihu.com/people/leozhang2018/activities" target="_blank" title="Zhihu"><i class="fab fa-fw fa-zhihu"></i>Zhihu</a></span></div></div></section></div><div class="chart-map" id="chart-map"></div><div class="chart-code" id="chart-code"></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2021</span> <span class="with-love"><div class="heart"></div></span><span class="author" itemprop="copyrightHolder">诸神黄昏 人间黎明</span></div><div class="footer-custom">leozhang2018</div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="https://lib.baomitu.com/jquery/2.1.3/jquery.min.js"></script><script type="text/javascript" src="https://lib.baomitu.com/velocity/1.2.1/velocity.min.js"></script><script type="text/javascript" src="https://lib.baomitu.com/velocity/1.2.1/velocity.ui.min.js"></script><script type="text/javascript" src="/js/src/utils.js?v=6.0.3"></script><script type="text/javascript" src="/js/src/motion.js?v=6.0.3"></script><script type="text/javascript" src="/js/src/heart.js?v=6.0.3"></script><script type="text/javascript" src="/js/src/echarts.js?v=6.0.3"></script><script type="text/javascript" src="/js/src/china.js?v=6.0.3"></script><script type="text/javascript" src="/js/src/map.js?v=6.0.3"></script><script type="text/javascript" src="/js/src/code.js?v=6.0.3"></script><script type="text/javascript" src="/js/src/asciinema-player.js?v=6.0.3"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=6.0.3"></script><script type="text/javascript" src="/js/src/post-details.js?v=6.0.3"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=6.0.3"></script></body></html>